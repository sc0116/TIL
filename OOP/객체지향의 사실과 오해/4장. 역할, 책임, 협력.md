# 4장. 역할, 책임, 협력

---

> 우리 모두를 합친 것보다 더 현명한 사람은 없다. - 켄 블랜차드

## 1. 협력

---

**협력**은 다수의 **요청**과 **응답**으로 구성되며 전체적으로 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성된다.

### 1-1 재판 속의 협력

이상한 나라의 앨리스의 다음 줄거리를 간략하게 살펴보자.
- 누군가가 파이를 훔쳤다는 혐의를 받고 있는 하트 잭에 대한 재판을 **요청**함으로써 재판이 시작된다.
- 재판을 하는 왕이 하얀 토끼에게 증인을 부를 것을 **요청**한다.
- 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 **요청**한다.
- 모자 장수는 증인석에 입장함으로써 토끼의 요청에 **응답**한다.
- 모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 **응답**이기도 하다.
- 이제 왕은 모자 장수에게 증언할 것을 **요청**한다.
- 모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 **응답**한다.

등장인물들이 특정한 요청을 받아들일 수 있는 이유는 그 요청에 대해 적절한 방식으로 응답하는 데 필요한 지식과 행동 방식을 가지고 있기 때문이다.  
그리고 요청과 응답은 협력에 참여하는 객체가 수행할 책임을 정의한다.

## 2. 책임

---


객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나, 적절한 행동을 할 의무가 있는 경우 해당 객체가 **책임**을 가진다고 말한다.  
어떤 대상에 대한 요청은 그 대상이 요청을 처리할 책임이 있음을 암시한다.
- 토끼는 '목격자를 불러오라'는 요청에 응답해야 하므로 '목격자를 불러올' 책임을 진다.

### 2-1. 책임의 분류

협력에 참여하는 객체들은 목표를 달성하는 데 필요한 책임을 수행한다.  
객체의 책임은 '객체가 무엇을 알고 있는가'와 '무엇을 할 수 있는가'로 구성된다.
- 하는 것(doing)
  - 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
  - 다른 객체의 행동을 시작시키는 것
  - 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것(knowing)
  - 개인적인 정보에 관해 아는 것
  - 관련된 객체에 관해 아는 것
  - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

**책임은 객체의 외부에 제공해 줄 수 있는 정보(아는 것의 측면)와 외부에 제공해 줄 수 있는 서비스(하는 것의 측면)의 목록이다.**  
따라서 책임은 객체의 **공용 인터페이스**를 구성한다.

### 2-2. 책임과 메시지

협력 안에서 객체는 다른 객체로부터 요청이 전송됐을 경우에만 자신에게 주어진 책임을 수행한다.  
객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것을 **메시지 전송**이라고 한다.

책임이 협력이라는 문맥 속에서 요청을 수신하는 한 쪽의 객체 관점에서 무엇을 할 수 있는지를 나열하는 것이라면 메시지는 협력에 참여하는 두 객체 사이의 관계를 강조한 것이다.

주의할 점은 책임과 메시지의 수준이 같지는 않다는 점이다.
- 책임은 객체가 협력에 참여하기 위해 수행해야 하는 행위를 상위 수준에서 개략적으로 서술한 것이다.
- 협력을 정제하면서 책임이 메시지로 변환할 때는 하나의 책임이 여러 메시지로 분할되는 것이 일반적이다.

## 3. 역할

---

### 3-1. 책임의 집합이 의미하는 것

어떤 객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다.  
- 왕은 '판사'라는 역할을 수행하고 있고 모자 장수는 '증인'이라는 역할을 수행하고 있음을 의미한다.

굳이 왕을 판사라고 부르고 모자 장수를 증인이라고 불러서 상황을 복잡하게 만드는 이유는 무엇인가?
- **역할이 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성요소이기 때문이다.**

### 3-2. 판사와 증인

이어지는 줄거리를 간략하게 살펴보자.
- 모자 장수에 이어 요리사와 앨리스가 재판의 증인으로 출석했다.
- 판사로서 재판을 주관하던 왕이 앨리스가 증인으로 채택된 시점에 여왕에게 자신의 일을 위임했다.

모자 장수, 요리사, 앨리스가 증인으로 참석하는 재판 과정은 전체적으로 그 흐름이 매우 유사하다.  
차이점이라고는 왕 대신 여왕이, 모자 장수 대신 요리사나 앨리스가 협력에 참여한다는 것뿐이다.

### 3-3. 역할이 답이다.

재판에서 왕-토끼-모자 장수, 왕-토끼-요리사, 여왕-토끼-앨리스라는 세 개의 협력이 주어져 있다.  
협력에 참여하는 등장인물들을 제외한 나머지 과정이 너무나도 유사해서 하나의 협력으로 다루고 싶다.

판사와 증인이라는 **역할**을 사용하면 세 가지 협력을 모두 포괄할 수 있는 하나의 협력으로 추상화할 수 있다.
- 누군가가 **판사**에게 재판을 요청함으로써 재판이 시작된다.
- **판사**가 하얀 토끼에게 증인을 부를 것을 요청한다.
- **판사**의 요청을 받은 토끼는 **증인**에게 증인석으로 입장할 것을 요청한다.
- **증인**은 증인석에 입장함으로써 토끼의 요청에 응답한다.
- **증인**의 입장은 연쇄적으로 토끼에 대한 **판사**의 요청에 대한 응답이기도 하다.
- 이제 **판사**는 **증인**에게 증언할 것을 요청한다.
- **증인**은 자신이 알고 있는 내용을 증언함으로써 **판사**의 요청에 응답한다.

협력 안에서 역할은 **"이 자리는 해당 역할을 수행할 수 있는 어떤 객체라도 대신할 수 있습니다"**라고 말하는 것과 같다.
- 판사 역할은 하트 왕과 하트 여왕이 대신할 수 있다.
- 증인 역할은 모자 장수, 요리사, 앨리스가 대신할 수 있다.

하지만 역할을 대체할 수 있는 객체는 동일한 메시지를 이해할 수 있는 객체로 한정된다.
- 동일한 역할을 수행할 수 있다는 것은 해당 객체들이 협력 내에서 동일한 책임의 집합을 수행할 수 있다는 것을 의미한다.

역할의 개념을 사용하면 유사한 **협력을 추상화**해서 인지 과부하를 줄일 수 있다.  
또한 다양한 객체들이 협력에 참여할 수 있기 때문에 협력이 좀 더 유연해지며 다양한 객체들이 동일한 협력에 참여할 수 있기 때문에 재사용성이 높아진다.  
**역할은 객체지향 설계의 단순성, 유연성, 재사용성을 뒷받침하는 핵심 개념이다.**

### 3-4. 대체 가능성

객체가 역할에 주어진 책임 이외에 다른 책임을 수행할 수도 있다.
- 모자 장수는 증인으로서의 역할뿐만 아니라 모자를 판매할 모자 장수로서의 책임을 가지고 있다.
- 객체는 역할이 암시하는 책임보다 더 많은 책임을 가질 수 있다.

따라서 대부분의 경우에 객체의 타입과 역할 사이에는 **일반화/특수화 관계**가 성립하는 것이 일반적이다.
- 좀 더 일반적인 개념을 의미하는 역할은 일반화다.
- 좀 더 구체적인 개념을 의미하는 객체의 타입은 특수화다.

**역할의 대체 가능성은 행위 호환성을 의미하고, 행위 호환성은 동일한 책임의 수행을 의미한다.**

## 4. 객체의 모양을 결정하는 협력

---

### 4-1. 흔한 오류

선입견
- 객체은 시스템에 필요한 데이터를 저장하기 위해 존재한다?
  - 행위를 수행하며 협력에 참여하기 위해 존재한다.
  - 실제로 중요한 것은 객체의 행동, 즉 책임이다.
- 객체지향이 클래스와 클래스 간의 관계를 표현하는 시스템의 정적인 측면에 중점을 둔다?
  - 중요한 것은 정적인 클래스가 아니라 협력에 참여하는 동적인 객체이며, 클래스는 단지 구현 메커니즘일 뿐이다.

### 4-2. 협력을 따라 흐르는 객체의 책임

협력을 설계한다는 것은 설계에 참여하는 객체들이 주고받을 요청과 응답의 흐름을 결정한다는 것을 의미한다.
- 결정된 요청과 응답의 흐름은 객체가 협력에 참여하기 위해 수행될 책임이 된다.

객체에게 책임을 할당하고 나면 책임은 객체가 외부에 제공하게 될 행동이 된다.
- 행동을 결정한 후에 그 행동을 수행하는 데 필요한 데이터를 고민해야 한다.
- 행동과 데이터가 어느 정도 결정된 후에 클래스의 구현 방법을 결정해야 한다.

## 5. 객체지향 설계 기법

객체지향 설계의 핵심은 올바른 책임을 올바른 객체에게 할당하는 것이다.

---

### 5-1. 책임-주도 설계

**책임-주도 설계** 방법은 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식으로 애플리케이션을 설계한다.
- 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 중에 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 된다.

역할, 책임, 협력은 유연하고 견고한 객체지향 시스템을 만드는 데 필요한 가장 중요한 재료다.  
**역할, 책임, 협력에 집중하라.**

### 5-2. 디자인 패턴

**디자인 패턴**은 전문가들이 반복적으로 사용하는 해결 방법을 정의해 놓은 설계(역할, 책임, 협력) 템플릿의 모음이다.
- 디자인 패턴은 책임-주도 설계의 결과를 표현한다.
- 패턴은 반복해서 일어나는 특정한 상황에서 어떤 설계가 왜 더 효과적인지에 대한 이유를 설명한다.

만약 특정한 상황에 적용 가능한 디자인 패턴을 잘 알고 있다면 책임-주도 설계의 절차를 순차적으로 따르지 않고도 시스템 안에 구현할 객체들의 역할과 책임, 협력 관계를 빠르고 손쉽게 포착할 수 있을 것이다.  
디자인 패턴은 책임-주도 설계의 결과물인 동시에 지름길이다.

### 5-3. 테스트-주도 개발

**테스트-주도 개발**은 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 애플리케이션을 완성해가는 방식이다.
- 이름에서 풍기는 뉘앙스와 달리 테스트가 아니라 설계를 위한 기법이다.
- 실제 목적은 구체적인 코드를 작성해나가면서 역할, 책임, 협력을 식별하고 식별된 역할, 책임, 협력이 적합한지를 피드백받는 것이다.

테스트-주도 개발은 테스트를 작성하는 것이 아니라 책임을 수행할 객체 또는 클라이언트가 기대하는 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것이다.

테스트-주도 개발은 책임-주도 설계를 통해 도달해야 하는 목적지를 테스트라는 안전장치를 통해 좀 더 빠르게 견고한 방법으로 도달할 수 있도록 해주는 최상의 설계 프랙티스다.

역할, 책임, 협력에 집중하고 객체지향의 원칙을 적용하려는 깊이 있는 고민과 노력을 통해서만 테스트-주도 개발의 혜택을 누릴 수 있다.
